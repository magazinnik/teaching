}
map(database = "county", regions = toplot$name[200:233], col = toplot$cols1[200:233],
lty = 0, fill = TRUE)
map(database = "state", region='california', lty = 0) # activate empty map
for(i in 200:233) {
map(database = "county", regions = toplot$name[i], col = toplot$cols1[i],
fill = TRUE, add = TRUE, lty = 0)
}
map(database = "county", regions = toplot$name[200:233], col = toplot$cols1[200:233],
lty = 0, fill = TRUE)
map(database = "county", regions = toplot$name[200:234], col = toplot$cols1[200:234],
lty = 0, fill = TRUE)
map(database = "state", region='california', lty = 0) # activate empty map
for(i in 200:234) {
map(database = "county", regions = toplot$name[i], col = toplot$cols1[i],
fill = TRUE, add = TRUE, lty = 0)
}
map(database = "county", lty = 0) # activate empty map
for(i in 200:234) {
map(database = "county", regions = toplot$name[i], col = toplot$cols1[i],
fill = TRUE, add = TRUE, lty = 0)
}
map(database = "county", regions = toplot$name[200:234], col = toplot$cols1[200:234],
lty = 0, fill = TRUE)
map(database = "county", lty = 0) # activate empty map
for(i in 200:234) {
map(database = "county", regions = toplot$name[i], col = toplot$cols1[i],
fill = TRUE, add = TRUE, lty = 0)
}
map(database = "county", regions = toplot$name[200:250], col = toplot$cols1[200:250],
lty = 0, fill = TRUE)
map(database = "county", lty = 0) # activate empty map
for(i in 200:250) {
map(database = "county", regions = toplot$name[i], col = toplot$cols1[i],
fill = TRUE, add = TRUE, lty = 0)
}
map(database = "county", regions = toplot$name[200:300], col = toplot$cols1[200:300],
lty = 0, fill = TRUE)
map(database = "county", lty = 0) # activate empty map
for(i in 200:300) {
map(database = "county", regions = toplot$name[i], col = toplot$cols1[i],
fill = TRUE, add = TRUE, lty = 0)
}
map
map(database = "county", regions = toplot$name[100:200], col = toplot$cols1[100:200],
lty = 0, fill = TRUE)
map(database = "county", lty = 0) # activate empty map
for(i in 100:200) {
map(database = "county", regions = toplot$name[i], col = toplot$cols1[i],
fill = TRUE, add = TRUE, lty = 0)
}
map(database = "county", regions = toplot$name[1:100], col = toplot$cols1[1:100],
lty = 0, fill = TRUE)
map(database = "county", lty = 0) # activate empty map
for(i in 1:100) {
map(database = "county", regions = toplot$name[i], col = toplot$cols1[i],
fill = TRUE, add = TRUE, lty = 0)
}
map(database = "county", regions = toplot$name[1:50], col = toplot$cols1[1:50],
lty = 0, fill = TRUE)
map(database = "county", lty = 0) # activate empty map
for(i in 1:50) {
map(database = "county", regions = toplot$name[i], col = toplot$cols1[i],
fill = TRUE, add = TRUE, lty = 0)
}
map(database = "county", regions = toplot$name[1:50], col = toplot$cols1[1:50],
lty = 0, fill = TRUE)
map(database = "state", region="alabama", lty = 0) # activate empty map
for(i in 1:50) {
map(database = "county", regions = toplot$name[i], col = toplot$cols1[i],
fill = TRUE, add = TRUE, lty = 0)
}
map(database = "county", regions = toplot$name[1:60], col = toplot$cols1[1:60],
lty = 0, fill = TRUE)
map(database = "state", region="alabama", lty = 0) # activate empty map
for(i in 1:60) {
map(database = "county", regions = toplot$name[i], col = toplot$cols1[i],
fill = TRUE, add = TRUE, lty = 0)
}
map(database = "county", regions = toplot$name[1:65], col = toplot$cols1[1:65],
lty = 0, fill = TRUE)
map(database = "state", region="alabama", lty = 0) # activate empty map
for(i in 1:65) {
map(database = "county", regions = toplot$name[i], col = toplot$cols1[i],
fill = TRUE, add = TRUE, lty = 0)
}
map(database = "county", regions = toplot$name[1:70], col = toplot$cols1[1:70],
lty = 0, fill = TRUE)
map(database = "state", region="alabama", lty = 0) # activate empty map
for(i in 1:70) {
map(database = "county", regions = toplot$name[i], col = toplot$cols1[i],
fill = TRUE, add = TRUE, lty = 0)
}
map(database = "county", regions = toplot$name[1:70], col = toplot$cols1[1:70],
lty = 0, fill = TRUE)
map(database = "state", region=c("alabama", "california"), lty = 0) # activate empty map
for(i in 1:70) {
map(database = "county", regions = toplot$name[i], col = toplot$cols1[i],
fill = TRUE, add = TRUE, lty = 0)
}
map(database = "county", regions = toplot$name[1:100], col = toplot$cols1[1:100],
lty = 0, fill = TRUE)
map(database = "state", region=c("alabama", "california"), lty = 0) # activate empty map
for(i in 1:100) {
map(database = "county", regions = toplot$name[i], col = toplot$cols1[i],
fill = TRUE, add = TRUE, lty = 0)
}
map(database = "county", regions = toplot$name[1:80], col = toplot$cols1[1:80],
lty = 0, fill = TRUE)
map(database = "state", region=c("alabama", "california"), lty = 0) # activate empty map
for(i in 1:80) {
map(database = "county", regions = toplot$name[i], col = toplot$cols1[i],
fill = TRUE, add = TRUE, lty = 0)
}
map(database = "county", regions = toplot$name[1:75], col = toplot$cols1[1:75],
lty = 0, fill = TRUE)
map(database = "state", region=c("alabama", "california"), lty = 0) # activate empty map
for(i in 1:75) {
map(database = "county", regions = toplot$name[i], col = toplot$cols1[i],
fill = TRUE, add = TRUE, lty = 0)
}
map(database = "county", regions = toplot$name[1:72], col = toplot$cols1[1:72],
lty = 0, fill = TRUE)
map(database = "state", region=c("alabama", "california"), lty = 0) # activate empty map
for(i in 1:72) {
map(database = "county", regions = toplot$name[i], col = toplot$cols1[i],
fill = TRUE, add = TRUE, lty = 0)
}
map(database = "county", regions = toplot$name[1:73], col = toplot$cols1[1:73],
lty = 0, fill = TRUE)
map(database = "state", region=c("alabama", "california"), lty = 0) # activate empty map
for(i in 1:73) {
map(database = "county", regions = toplot$name[i], col = toplot$cols1[i],
fill = TRUE, add = TRUE, lty = 0)
}
map(database = "county", regions = toplot$name[1:74], col = toplot$cols1[1:74],
lty = 0, fill = TRUE)
map(database = "state", region=c("alabama", "california"), lty = 0) # activate empty map
for(i in 1:74) {
map(database = "county", regions = toplot$name[i], col = toplot$cols1[i],
fill = TRUE, add = TRUE, lty = 0)
}
map(database = "county", regions = toplot$name[1:75], col = toplot$cols1[1:75],
lty = 0, fill = TRUE)
map(database = "state", region=c("alabama", "california"), lty = 0) # activate empty map
for(i in 1:75) {
map(database = "county", regions = toplot$name[i], col = toplot$cols1[i],
fill = TRUE, add = TRUE, lty = 0)
}
map(database = "county", regions = toplot$name[1:76], col = toplot$cols1[1:76],
lty = 0, fill = TRUE)
map(database = "state", region=c("alabama", "california"), lty = 0) # activate empty map
for(i in 1:76) {
map(database = "county", regions = toplot$name[i], col = toplot$cols1[i],
fill = TRUE, add = TRUE, lty = 0)
}
map(database = "county", regions = toplot$name[1:76], col = toplot$cols1[1:76],
lty = 0, fill = TRUE)
map(database = "county", regions = toplot$name[1:75], col = toplot$cols1[1:75],
lty = 0, fill = TRUE)
map(database = "county", regions = toplot$name[1:76], col = toplot$cols1[1:76],
lty = 0, fill = TRUE)
map(database = "county", regions = toplot$name[1:75], col = toplot$cols1[1:75],
lty = 0, fill = TRUE)
map(database = "county", regions = toplot$name[1:75], col = toplot$cols1[1:75],
lty = 0, fill = TRUE)
map(database = "county", regions = toplot$name[1:76], col = toplot$cols1[1:76],
lty = 0, fill = TRUE)
map(database = "county", regions = toplot$name[1:75], col = toplot$cols1[1:75],
lty = 0, fill = TRUE)
map(database = "county", regions = toplot$name[1:76], col = toplot$cols1[1:76],
lty = 0, fill = TRUE)
map(database = "state", region=c("alabama", "california"), lty = 0) # activate empty map
for(i in 1:75) {
map(database = "county", regions = toplot$name[i], col = toplot$cols1[i],
fill = TRUE, add = TRUE, lty = 0)
}
map(database = "county", regions = toplot$name[1:75], col = toplot$cols1[1:75],
lty = 0, fill = TRUE)
set.seed(123)
map(database = "county", regions = toplot$name[1:74], col = toplot$cols1[1:74],
lty = 0, fill = TRUE)
map(database = "state", region=c("alabama", "california"), lty = 0) # activate empty map
for(i in 1:75) {
map(database = "county", regions = toplot$name[i], col = toplot$cols1[i],
fill = TRUE, add = TRUE, lty = 0)
}
map(database = "county", regions = toplot$name[1:75], col = toplot$cols1[1:74],
lty = 0, fill = TRUE)
map(database = "state", region=c("alabama", "california"), lty = 0) # activate empty map
for(i in 1:75) {
map(database = "county", regions = toplot$name[i], col = toplot$cols1[i],
fill = TRUE, add = TRUE, lty = 0)
}
map(database = "county", regions = toplot$name[1:74], col = toplot$cols1[1:74],
lty = 0, fill = TRUE)
map(database = "county", regions = toplot$name[1:75], col = toplot$cols1[1:75],
lty = 0, fill = TRUE)
map(database = "county", regions = toplot$name[1:74], col = toplot$cols1[1:74],
lty = 0, fill = TRUE)
map(database = "county", regions = toplot$name[1:75], col = toplot$cols1[1:75],
lty = 0, fill = TRUE)
for(i in 1:74) {
map(database = "county", regions = toplot$name[i], col = toplot$cols1[i],
fill = TRUE, add = TRUE, lty = 0)
}
map(database = "state", region=c("alabama", "california"), lty = 0) # activate empty map
for(i in 1:74) {
map(database = "county", regions = toplot$name[i], col = toplot$cols1[i],
fill = TRUE, add = TRUE, lty = 0)
}
map(database = "county", regions = toplot$name[1:74], col = toplot$cols1[1:74],
lty = 0, fill = TRUE)
map(database = "county", regions = toplot$name[1:74], col = toplot$cols1[1:74],
lty = 0, fill = TRUE)
map(database = "county", regions = toplot$name[1:75], col = toplot$cols1[1:75],
lty = 0, fill = TRUE)
toplot[75,]
toplot[74,]
map(database = "state", region=c("alabama", "arizona"), lty = 0) # activate empty map
for(i in 1:74) {
map(database = "county", regions = toplot$name[i], col = toplot$cols1[i],
fill = TRUE, add = TRUE, lty = 0)
}
map(database = "county", regions = toplot$name[1:74], col = toplot$cols1[1:74],
lty = 0, fill = TRUE)
map(database = "county", regions = toplot$name[1:75], col = toplot$cols1[1:75],
lty = 0, fill = TRUE)
map(database = "county", regions = toplot$name[1:74], col = toplot$cols1[1:74],
lty = 0, fill = TRUE)
map(database = "county", regions = toplot$name[1:75], col = toplot$cols1[1:75],
lty = 0, fill = TRUE)
toplot[75,]
color.names("#0000FF99")
color.id("#0000FF99")
library("plotrix")
color.id("#0000FF99")
map(database = "county", regions = toplot$name[1:74], col = toplot$cols1[1:74],
lty = 0, fill = TRUE)
map(database = "county", regions = toplot$name[1:75], col = toplot$cols1[1:75],
lty = 0, fill = TRUE)
toplot[75,]
color.id("#0000FF99")
map(database = "county", regions = toplot$name[74], col = toplot$cols1[74],
lty = 0, fill = TRUE)
map(database = "county", regions = toplot$name[75], col = toplot$cols1[75],
lty = 0, fill = TRUE)
set.seed(123)
map(database = "county", regions = toplot$name[1:74], col = toplot$cols1[1:74],
lty = 0, fill = TRUE)
map(database = "state", region=c("alabama", "arizona"), lty = 0) # activate empty map
for(i in 1:74) {
map(database = "county", regions = toplot$name[i], col = toplot$cols1[i],
fill = TRUE, add = TRUE, lty = 0)
}
toplot[75,]
returns12 <- read.csv("data/electoral returns 2012.csv")
returns16 <- read.csv("data/electoral returns 2016.csv")
covars <- read.csv("data/county level data.csv")
names(returns12) <- c("state", "county", "FIPS", "votes_dem_12", "votes_gop_12", "votes_total_12")
names(returns16) <- c("state", "county", "FIPS", "votes_dem_16", "votes_gop_16", "votes_total_16")
returns <- merge(returns12, returns16[, !names(returns16) %in% c("state", "county")], by = "FIPS")
dim(returns12)
dim(returns16)
dim(returns)
merged <- merge(returns, covars, by = "FIPS", all.x = TRUE)
final <- na.omit(merged)
dim(merged)
dim(final)
lost <- merged[merged$FIPS %in% final$FIPS == FALSE, ]
lost$county
final$gop_vs_12 <- final$votes_gop_12 / final$votes_total_12
final$gop_vs_16 <- final$votes_gop_16 / final$votes_total_16
final$gop_vs_pct_ch <- ((final$gop_vs_16 - final$gop_vs_12) / final$gop_vs_12) * 100
battlestates <- c("FL", "NC", "OH", "PA", "NH", "MI", "WI", "IA", "NV", "CO", "VA")
battle <- subset(final, state %in% battlestates)
table(battle$state) ## check that you subset properly
par(mfrow = c(1, 2), pin = c(2, 2.5)) ## put plots side by side
hist.full <- hist(final$gop_vs_pct_ch,
freq = FALSE,
main = "Distribution of change in Rep. vote share", cex.main = .8,
xlab = "Percent change",
ylim = c(0, .05))
abline(v = median(final$gop_vs_pct_ch), col = "red")
hist.battle <- hist(battle$gop_vs_pct_ch,
freq = FALSE,
main = "Distribution of change in Rep. vote share,
battleground states", cex.main = .8,
xlab = "Percent change",
ylim = c(0, .05))
library(maps)
library(ggmap)
final <- final[,c("FIPS", "state", "county", "gop_vs_pct_ch")]
cf <- county.fips
names(cf) <- c("FIPS", "name")
toplot <- merge(cf, final, by = "FIPS", all.x = TRUE)
alpha.compute <- function(invar) {
var <- abs(invar) ## absolute value
quants <- quantile(var, na.rm = TRUE)
alpha <- ifelse(var < quants[2], .2,
ifelse(var >= quants[2] & var < quants[3], .4,
ifelse(var >= quants[3] & var < quants[4], .6, .8)))
alpha <- ifelse(is.na(alpha), 0, alpha)
return(alpha)
}
alpha1 <- alpha.compute(invar = toplot$gop_vs_pct_ch)
toplot$cols1 <- ifelse(toplot$gop_vs_pct_ch < 0,
rgb(red = 0, blue = 1, green = 0, alpha = alpha1),
rgb(red = 1, blue = 0, green = 0, alpha = alpha1))
df <- map_data("county")
counties <- unique(paste(df$region, df$subregion))
map(database = "county", col = toplot$cols1[-2390], lty = 0, fill = TRUE)
par(mfrow =c(1,1))
map(database = "county", col = toplot$cols1[-2390], lty = 0, fill = TRUE)
map(database = "county", lty = 0)
for(i in 1:nrow(toplot)) {
map(database = "county", regions = toplot$name[i], col = toplot$cols1[i], fill = TRUE, add = TRUE,
lty = 0)
}
load("data/county_data_full.RData")
head(final)
library(maps)
library(ggmap)
cf <- county.fips # from maps library
names(cf) <- c("FIPS", "name")
toplot <- merge(cf, final, by = "FIPS", all.x = TRUE)
head(toplot)
map(database = "county", col = toplot$cols1, lty = 0, fill = TRUE)
map(database = "county", lty = 0) # activate empty map
for(i in 1:nrow(toplot)) {
map(database = "county", regions = toplot$name[i], col = toplot$cols1[i],
fill = TRUE, add = TRUE, lty = 0)
}
df <- map_data("county")
head(df)
length(unique(paste(df$region, df$subregion))) # county dataset
length(cf$name) # fips dataset
map(database = "county", regions = toplot$name, col = toplot$cols1, lty = 0, fill = TRUE)
set.seed(123)
map(database = "county", regions = toplot$name[1:74], col = toplot$cols1[1:74],
lty = 0, fill = TRUE)
map(database = "state", region=c("alabama", "arizona"), lty = 0) # activate empty map
for(i in 1:74) {
map(database = "county", regions = toplot$name[i], col = toplot$cols1[i],
fill = TRUE, add = TRUE, lty = 0)
}
map(database = "county", regions = toplot$name[1:75], col = toplot$cols1[1:75],
lty = 0, fill = TRUE)
map(database = "county", regions = toplot$name[75], col = toplot$cols1[75],
lty = 0, fill = TRUE)
head(toplot)
head(final)
toplot[75,]
toplot[70:80,]
df <- map_data("county")
head(df)
toplot$name[1:10]
df[74,]
df[74:75,]
df[1,]
head(df)
df2 <- df[,"group", "region", "subregion"]
df2 <- df[,c("group", "region", "subregion")]
head(df2)
df3 <- unique(df2)
head(df3)
df3[1:100,]
toplot$name[1:75]
head(toplot)
geog <- paste(df3$region, df3$subregion, sep=",")
head(geog)
toplot2 <- toplot[toplot$name %in% df3$region,]
dim(toplot2)
head(toplot2$name)
head(toplot$name)
head(df3$region)
toplot2 <- toplot[toplot$name %in% geog,]
dim(toplot2)
map(database = "county", regions = toplot2$name, col = toplot2$cols1,
lty = 0, fill = TRUE)
map(database = "county", regions = toplot2$name[1:2000], col = toplot2$cols1[1:2000],
lty = 0, fill = TRUE)
map(database = "county", lty = 0) # activate empty map
for(i in 1:2000) {
map(database = "county", regions = toplot$name[i], col = toplot$cols1[i],
fill = TRUE, add = TRUE, lty = 0)
}
map(database = "county", regions = toplot2$name[1:2000], col = toplot2$cols1[1:2000],
lty = 0, fill = TRUE)
map(database = "county", lty = 0) # activate empty map
for(i in 1:2000) {
map(database = "county", regions = toplot2$name[i], col = toplot2$cols1[i],
fill = TRUE, add = TRUE, lty = 0)
}
head(toplot2)
head(df3)
map()
map
map(database = "county", regions = toplot2$name[1:2000], col = toplot2$cols1[1:2000],
lty = 0, fill = TRUE)
head(toplot2)
head(df3)
cbind(toplot2, df3)
dim(toplot2)
df3$geog <- paste(df3$region, df3$subregion, sep=",")
?left_join
df3$name <- paste(df3$region, df3$subregion, sep=",")
head(df3)
df3 <- df3[,-4]
head(df3)
merged <- dplyr::left_join(df3, toplot2, by="name")
head(merged)
merged[merged$region=="arizona",]
toplot2[toplot2$subregion=="la paz",]
toplot2[toplot2$name=="arizona,la paz",]
map(database = "county", regions = merged$name[1:2000], col = merged$cols1[1:2000],
lty = 0, fill = TRUE)
map(database = "county", regions = merged$name[1:2500], col = merged$cols1[1:2500],
lty = 0, fill = TRUE)
map(database = "county", lty = 0) # activate empty map
for(i in 1:2500) {
map(database = "county", regions = toplot2$name[i], col = toplot2$cols1[i],
fill = TRUE, add = TRUE, lty = 0)
}
map(database = "county", regions = merged$name, col = merged$cols1,
lty = 0, fill = TRUE)
map(database = "county", regions = merged$name[1:2500], col = merged$cols1[1:2500],
lty = 0, fill = TRUE)
head(df3)
head(df)
df <- map_data("county")
df <- map_data("county")[,c("group", "region", "subregion")]
head(df)
geog <- unique(map_data("county")[,c("group", "region", "subregion")])
head(geog)
geog$name <- paste(geog$region, geog$subregion, sep=",")
geog <- unique(map_data("county")[,c("group", "region", "subregion")])
geog$name <- paste(geog$region, geog$subregion, sep=",")
merged <- dplyr::left_join(geog, toplot, by="name")
map(database = "county", regions = merged$name[1:2500], col = merged$cols1[1:2500],
lty = 0, fill = TRUE)
map(database = "county", lty = 0) # activate empty map
for(i in 1:2500) {
map(database = "county", regions = toplot$name[i], col = toplot$cols1[i],
fill = TRUE, add = TRUE, lty = 0)
}
geog <- map_data("county")
head(geog)
length(unique(paste(geog$region, geog$subregion))) # county dataset
length(cf$name) # fips dataset
geog$name <- paste(geog$region, geog$subregion, sep=",")
merged <- dplyr::left_join(geog, toplot, by="name")
head(merged)
map(database = "county", regions = merged$name, col = merged$cols1, lty = 0, fill = TRUE)
map(database = "county", regions = merged$name[1:2000], col = merged$cols1[1:2000],
lty = 0, fill = TRUE)
merged$name[1:2000]
counties <- unique(merged$name)
colors <- unique(merged$cols1)
counties <- unique(merged$name)
colors <- unique(merged$cols1)
map(database = "county", regions = counties[1:2000], col = colors[1:2000],
lty = 0, fill = TRUE)
counteis
counties
colors
counties <- unique(merged$name)
colors <- unique(merged$cols1)
map(database = "county", regions = counties, col = colors,
lty = 0, fill = TRUE)
length(counties)
map(database = "county", regions = counties[1:2500], col = colors[1:2500],
lty = 0, fill = TRUE)
head(merged)
map(database = "county", lty = 0) # activate empty map
for(i in 1:2000) {
map(database = "county", regions = toplot$name[i], col = toplot$cols1[i],
fill = TRUE, add = TRUE, lty = 0)
}
colors
merged.unique <- unique(merged[,c("name", "cols1")])
dim(merged.unique)
merged.unique <- unique(merged[,c("name", "cols1")])
map(database = "county", regions = merged.unique$name[1:2500],
col = merged.unique$cols1[1:2500], lty = 0, fill = TRUE)
merged.unique <- unique(merged[,c("name", "cols1")])
map(database = "county", regions = merged.unique$name[1:2500],
col = merged.unique$cols1[1:2500], lty = 0, fill = TRUE)
# loop approach
map(database = "county", lty = 0) # activate empty map
for(i in 1:2500) {
map(database = "county", regions = toplot$name[i], col = toplot$cols1[i],
fill = TRUE, add = TRUE, lty = 0)
}
merged.unique
head(geog)
length(unique(geog$name))
dim(merged.unique)
unique(geog$name)==merged.unique$name
sum(unique(geog$name)!=merged.unique$name)
merged.unique <- unique(merged[,c("name", "cols1")])
map(database = "county", regions = merged.unique$name[1:2500],
col = merged.unique$cols1[1:2500], lty = 0, fill = TRUE)
# loop approach
map(database = "county", lty = 0) # activate empty map
for(i in 1:2500) {
map(database = "county", regions = toplot$name[i], col = toplot$cols1[i],
fill = TRUE, add = TRUE, lty = 0)
}
install.packages("tmap")
install.packages("tmaptools")
install.packages("CBPS")
